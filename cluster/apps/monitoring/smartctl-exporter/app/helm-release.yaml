---
apiVersion: source.toolkit.fluxcd.io/v1beta2
kind: OCIRepository
metadata:
  name: smartctl-exporter-charts
spec:
  interval: 15m
  layerSelector:
    mediaType: application/vnd.cncf.helm.chart.content.v1.tar+gzip
    operation: copy
  ref:
    tag: "0.16.0"
  url: oci://ghcr.io/prometheus-community/charts
# https://github.com/jr0dd/home-ops/blob/main/cluster/apps/monitoring/grafana/helm-release.yaml
#  smart-summary:
#     url: https://raw.githubusercontent.com/jr0dd/grafana-dashboards/main/smart-summary.json
#     datasource: Prometheus
#   smart-errors:
#     url: https://raw.githubusercontent.com/jr0dd/grafana-dashboards/main/smart-errors.json
#     datasource: Prometheus
#
# https://www.wirewd.com/hacks/blog/monitoring_a_mixed_fleet_of_flash_hdd_and_nvme_devices_with_node_exporter_and_prometheus
#
---
apiVersion: helm.toolkit.fluxcd.io/v2beta2
kind: HelmRelease
metadata:
  name: &app smartctl-exporter
spec:
  interval: 30m
  chartRef:
    kind: OCIRepository
    name: smartctl-exporter-charts
  values:
    fullnameOverride: *app
    serviceMonitor:
      enabled: true
      interval: 30m
    prometheusRules:
      enabled: true
